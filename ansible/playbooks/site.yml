---
- name: Configure HP EliteDesk Homelab Server
  hosts: homelab-1
  vars_files:
    - '../inventories/homelab/group_vars/vault.yml'
  become: yes
  gather_facts: yes
  
  pre_tasks:
    - name: Set hostname
      hostname:
        name: homelab-1
  
  roles:
    - {"role": "geerlingguy.docker"}
    - {"role": "backup-data-zfs", "tags": ["backup-data-zfs", "zfs"]}
    - {"role": "data-ssd", "tags": "data-ssd"}
    - {"role": "backup-storage", "tags": "backup-storage"}
    - {"role": "samba", "tags": "samba"}
    - {"role": "docker"}
    - {"role": "ufw", "tags": "ufw"}
    - {"role": "cockpit"}
    - {"role": "portainer"}
    - {"role": "plex"}
    - {"role": "sabnzbd", "tags": "sabnzbd"}
    - {"role": "jellyfin", "tags": "jellyfin"}
    - {"role": "ytdl-sub"}
    - {"role": "node-exporter", "tags": "monitoring"}
    - {"role": "cadvisor", "tags": "monitoring"}
    - {"role": "prometheus", "tags": "monitoring"}
    - {"role": "alertmanager", "tags": "monitoring"}
    - {"role": "homelab-dashboard", "tags": "dashboard"}
    - {"role": "synology-nas", "tags": "nas"}
    - {"role": "tailscale", "tags": "tailscale"}

  post_tasks:
    - name: Display service URLs
      debug:
        msg: |
          Services are now available at:
          - Dashboard: http://{{ ansible_host }}
          - Cockpit: https://{{ ansible_host }}:9090
          - Portainer: http://{{ ansible_host }}:9000
          - SABnzbd: http://{{ ansible_host }}:8080
          - Plex: http://{{ ansible_host }}:32400/web
          - Jellyfin: http://{{ ansible_host }}:8096
          - ytdl-sub: http://{{ ansible_host }}:8443
          - Prometheus: http://{{ ansible_host }}:9091
          - Alertmanager: http://{{ ansible_host }}:9093
          - cAdvisor: http://{{ ansible_host }}:8081
          - Samba share: \\{{ ansible_host }}\docker-data
          - NAS mounts: Check /mnt/nas/ for mounted Synology shares